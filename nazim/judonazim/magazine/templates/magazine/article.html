<!DOCTYPE html>
{%extends 'magazine/base.html'%}
{%load static%}


    <meta charset="utf-8">
    {%block title%}מאמר דעה{%endblock%}

   {%block moreLinks%}{%endblock moreLinks%}

     {%block body%}
    <div class="center">
     <div class="post">

       <span class="posttitle shiny-blue-clr">{{ object.title }}  </span>

       {% if object.author.profile.profile_img.url %}
           <a class="author big tiny-row-center-align"> <img class="tiny-avatar" src="{{object.author.profile.profile_img.url}}"/>  <span> {{object.author | safe}}</span> &nbsp; | &nbsp;
                <span>{{object.datepublished | date:'d/m/Y' | safe}}</span>
           </a>
       {% else %}
       <a class="author big tiny-row-end-align"> {% include 'members/default_profile_img.html' %}  <span>  {{object.author | safe}}</span> &nbsp; | &nbsp;
            <span>{{object.datepublished | date:'d/m/Y' | safe}}</span>
       </a>
       {% endif %}
       <div  class="subtitle">{{object.subtitle}}</div>
       <div class="thumb-holder">
         <img class="thumb  big" src="{{object.thumb.url}}" alt="">
         <div class="decortion-line"></div>
       </div>
       <div class="post-content">
        {{object.content | safe}}
       </div>
       {% if user.is_authenticated %}
           {% if object.author_id == request.user.id and request.user.groups.all.0.name == 'admin' or request.user.groups.all.0.name == 'owner'  %}
       <div class = "submit-row submit-row-edit">
         <a style="text-decoration:none;" href="{% url 'magazine:updateRecord'  object.id %}">{%include 'magazine/components/btns/btnedit.html'%}</a>

       </div>
           {% endif %}
       {% endif %}
     </div>

<form method="POST">
  {%csrf_token%}
   <div class="center" style="margin-top:50px;">
      <div class="comment comment-frm">
         <span class="leave-comment-label">כתיבת תגובה</span>
         <div style="width:100%;">
           <span class="comment-label">התגובה שלך</span>
           {{comment_frm.body}}
        </div>
        <div style="width:100%;">
          <span class="comment-label">שם</span>
          {{comment_frm.name}}
      </div>
     <button type="submit" class="btn-post-comment" name="btn-send-comment">שלח</button>
     {% if object.comments.all|length > 0 %}
   <div class="tiny-row-center-align comment-reply-title" style="justify-content:center;width:100%;margin-top:20px;"><span id="lbl-count-comments"> {{object.comments.all | length}}</span> <span>תגובות למאמר</span></div>
     {% endif %}
   </div>
 </div>
</form>


 <div class="center"  style="margin-bottom:50px;">
   <form method="POST">
    {%csrf_token%}
   {% if object.comments.all %}


      {% for comment in object.comments.all %}

        <div class="comment item" style="gap:10px;margin-bottom:50px;width:500px;"  id="comment{{comment.pk}}">
          <span class="comment" style="gap:5px;">
            <div class="super-tiny-row-center-align" style="gap:5px;">
              <strong class="order-num" style="left:10px;position:relative;color:#E00041">
              {{forloop.counter}}
            </strong>
              <span class="order-num" style="left:10px;position:relative;">
                {% if comment.comment_usr.profile.profile_img.url %}
               <img class="very-tiny-avatar" src="{{comment.comment_usr.profile.profile_img.url}}"/>
               {% else %}
               {% include 'members/default_profile_img.html' %}
              {%endif%}
            </span>
              <b style="margin-right:-10px;" class="author author-comment">{{comment.name}} הגיב:</b>
            </div>
            <a id="{{comment.pk}}" href ="#comment{{comment.pk}}" class="tiny-row-center-align"><span style="color:#2F9BDD;">{{comment.date_added | date:'d/m/Y' | safe}} בשעה: {{comment.date_added | date:'h:m' | safe}}</span></a>
          </span>
          {{comment.body}}

          <div class="reply-parent"><span class="reply-label" comment-id="{{comment.pk}}">הגב</span></div>



          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill expand" viewBox="0 0 16 16" style="margin-top:5px;">
          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
          </svg>

          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-circle-fill collpase" viewBox="0 0 16 16" style="display:none;margin-top:5px;">
         <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7z"/>
         </svg>
          <div class="comment-of-comment" id="sub-comment{{comment.pk}}" style="display:none;">
          {% for comment_of_comment in comment.comments_of_comment.all %}
          <div class="item subitem" style="margin-top:10px;">
          <span style="gap:5px;">
            <div class="super-tiny-row-center-align" style="gap:5px;">

              <span class="order-num" style="left:10px;position:relative;">
                {% if comment_of_comment.comment_of_comment_usr.profile.profile_img.url %}
               <img class="super-tiny-avatar" src="{{comment_of_comment.comment_of_comment_usr.profile.profile_img.url}}"/>
               {% else %}
               {% include 'members/default_profile_img.html' %}
              {%endif%}
            </span>
              <b style="margin-right:-10px;" class="author author-sub-comment">{{comment_of_comment.name}} הגיב:</b>
            </div>
            <a id="a-sub-comment{{comment.pk}}" href ="#sub-comment{{comment.pk}}" class="tiny-row-center-align"><span class="tiny-font" style="color:#2F9BDD;">{{comment_of_comment.date_added | date:'d/m/Y' | safe}} בשעה: {{comment_of_comment.date_added | date:'h:m' | safe}}</span></a>
          </span>
          <span class="sub-comment">{{comment_of_comment.body}}</span>
        </div>
        {% endfor %}
      </div>
        </div>

      {% endfor %}



      <div class="center" id="reply-frm" style="margin-top:50px;display:none;">
        <input type="hidden" name="comment_id" id="comment_id">
         <div class="comment comment-frm">
            <div style="width:100%;">
              <span class="comment-label">התגובה שלך</span>
              {{com_of_com_frm.body}}
           </div>
           <div style="width:100%;">
             <span class="comment-label">שם</span>
             {{com_of_com_frm.name}}
         </div>
        <button type="submit" class="btn-post-comment" name="btn-reply-comment-of-comment">הגב</button>

      </div>
    </div>

   {% endif %}
    </form>
     </div>
   </div>


  <script type="text/javascript" src="{% static 'plugins/jquery.js'%}"> </script>
   <script>
    $(document).ready(function(){


       $('.comment.item').each(function(){
         var sub_comments_count = $(this).find('.subitem').length;
         if(sub_comments_count == 0)
         {
           $(this).find('.expand').first().hide();

           $(this).find('.collpase').first().hide();
         }
       });
      var total_comments = $('.item').length;
       $('#lbl-count-comments').text(total_comments);
      if("{{status}}" == "posted")
      {
         $('.comment-field').val('');
         var a_id =  "{{com_obj.pk}}";
         var href = $("#" + String(a_id)).attr("href");
         window.location.href = href
      }
    });
    $('.reply-label').click(function(){
      $(this).after($('#reply-frm'));
      $('#comment_id').val($(this).attr('comment-id'));
      $('#reply-frm').show();
    });

    $('.expand').click(function(){
      $(this).nextAll('.comment-of-comment').show();
      $(this).hide();
      $(this).siblings('.collpase').first().show();
    });

    $('.collpase').click(function(){
      $(this).nextAll('.comment-of-comment').hide();
      $(this).hide();
      $(this).siblings('.expand').first().show();
    });
   </script>


  {%endblock body%}
