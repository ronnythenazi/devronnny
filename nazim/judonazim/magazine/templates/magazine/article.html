<!DOCTYPE html>
{%extends 'magazine/base.html'%}
{%load static%}



{%block meta%}
<meta property="og:locale" content="he_IL">
<meta property="og:type" content="article">
<meta property="og:title" content="{{object.title}}">
<meta property="og:description" content="{{object.subtitle}}">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:image" content="{{object.thumb.url}}">
<meta property="og:image:height" content="324">
<meta property="og:image:width" content="583">
<meta property="og:site_name" content="יהודונאציזם">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@judonazimwebsite">
<meta name="twitter:image" content="{{object.thumb.url}}">
<meta name="twitter:title" content="{{object.title}}">
<meta name="twitter:description" content="{{object.subtitle}}">
{%endblock meta%}


  {%block title%}יהודונאציזם - מאמר דעה{%endblock%}

   {%block moreLinks%}
   {%endblock moreLinks%}

     {%block body%}
    <div class="center" style="width:100%;">
     <div class="post">
       <span class="posttitle shiny-blue-clr post-title-slug" style="font-family:formal3-bold;color:black !important;opacity:0.9;font-size:3.5rem;">{{ object.title }}  </span>
     <div id="rate-post-form" class="tiny-row-center-align">
       {% if object.author.profile.profile_img.url %}
           <a class="author big tiny-row-center-align"> <img class="tiny-avatar" src="{{object.author.profile.profile_img.url}}"/>  <span> {{object.author | safe}}</span> &nbsp; | &nbsp;
                <span>{{object.datepublished | date:'d/m/Y' | safe}}</span>
           </a>
       {% else %}
       <a class="author big tiny-row-end-align"> {% include 'members/default_profile_img.html' %}  <span>  {{object.author | safe}}</span> &nbsp; | &nbsp;
            <span>{{object.datepublished | date:'d/m/Y' | safe}}</span>
       </a>
       {% endif %}
       {% if user.is_authenticated %}
       <div class="tiny-row-center-align">
        <button class="unstyled-btn ajax-rate-btn" name="like-btn" type="button">
        {% if liked %}
        <span class="user_liked">{% include 'magazine/components/svg/like_fill.html'%}</span>
        <span class="user_unliked" style="display:none;">{% include 'magazine/components/svg/like.html'%}</span>
        {% else %}
        <span class="user_liked" style="display:none;">{% include 'magazine/components/svg/like_fill.html'%}</span>
        <span class="user_unliked">{% include 'magazine/components/svg/like.html'%}</span>
        {% endif %}
        </button>
        {% if total_likes != 0 %}
        <span  class="rate-count rate-green">{{total_likes}}</span>
        {% else %}
        <span style="display:none;" class="rate-count rate-green"></span>
        {% endif %}
        <button class="unstyled-btn ajax-rate-btn" name="dislike-btn" type="button">
        {% if disliked %}
        <span class="user_disliked">{% include 'magazine/components/svg/dislike_fill.html'%}</span>
        <span class="user_undisliked" style="display:none;">{% include 'magazine/components/svg/dislike.html'%}</span>
        {% else %}
        <span class="user_disliked" style="display:none;">{% include 'magazine/components/svg/dislike_fill.html'%}</span>
        <span class="user_undisliked"> {% include 'magazine/components/svg/dislike.html'%}</span>
        {% endif %}
        </button>
        {% if total_dislikes != 0 %}
        <span class="rate-count rate-red">{{total_dislikes}}</span>
        {% else %}
        <span style="display:none;" class="rate-count rate-red"></span>
        {% endif %}
      </div>
       {% else %}
       <button class="unstyled-btn" type="button">
           {% include 'magazine/components/svg/like.html'%}
       </button>
       {% if total_likes != 0 %}
       <span class="rate-count rate-green">{{total_likes}}</span>
       {% else %}
       <span style="display:none;" class="rate-count rate-green">{{total_likes}}</span>
       {% endif %}
       <button class="unstyled-btn" type="button">
           {% include 'magazine/components/svg/dislike.html'%}
       </button>
       {% if total_dislikes != 0 %}
        <span class="rate-count rate-red">{{total_dislikes}}</span>
        {% else %}
        <span style="display:none;" class="rate-count rate-red">{{total_dislikes}}</span>
        {% endif %}
        <span class="msg ice-cream-clr">הירשם ותוכל להשפיע</span>
       {% endif %}
     </div>

         <div class="subtitle post-subtitle-slug">{{object.subtitle}}</div>




       <div class="thumb-holder" style="width:100%;">
         <img class="thumb"  style="height:unset;" src="{{object.thumb.url}}" alt="">
         <div class="decortion-line"></div>
       </div>
       <div class="post-content">
        {{object.content | safe}}
       </div>
       {% if user.is_authenticated %}
           {% if object.author_id == request.user.id and request.user.groups.all.0.name == 'admin' or request.user.groups.all.0.name == 'owner'  %}
       <div class = "submit-row submit-row-edit">
         <a style="text-decoration:none;" href="{% url 'magazine:updateRecord'  object.id %}">{%include 'magazine/components/btns/btnedit.html'%}</a>

       </div>
           {% endif %}
       {% endif %}
     </div>

<form method="POST">
  {%csrf_token%}
   <div class="center" style="margin-top:50px;">
      <div class="comment comment-frm">
         <span class="leave-comment-label">כתיבת תגובה</span>
         <div style="width:100%;">
           <span class="comment-label">התגובה שלך</span>
           {{comment_frm.body}}
        </div>
        <div style="width:100%;">
          <span class="comment-label">שם</span>
          {{comment_frm.name}}
      </div>
     <button type="submit" style="width:100%;" class="btn-post-comment btn-loader" name="btn-send-comment">שלח</button>
     {% if object.comments.all|length > 0 %}
   <div class="tiny-row-center-align comment-reply-title" style="justify-content:center;width:100%;margin-top:20px;"><span id="lbl-count-comments"> {{object.comments.all | length}}</span> <span>תגובות למאמר</span></div>
     {% endif %}
   </div>
 </div>


</form>


 <div class="center"  style="margin-bottom:50px;">


   {% if object.comments.all %}




      {% for comment in object.comments.all %}

        <div class="comment item" id="comment{{comment.pk}}" style="gap:10px;margin-bottom:50px;width:500px;">
          <span class="comment" style="gap:5px;">
            <div class="super-tiny-row-center-align" style="gap:5px;">
              <strong class="order-num" style="left:10px;position:relative;color:#E00041">
              {{forloop.counter}}
            </strong>
              <span class="order-num" style="left:10px;position:relative;">
                {% if comment.comment_usr.profile.profile_img.url %}
               <img class="very-tiny-avatar" src="{{comment.comment_usr.profile.profile_img.url}}"/>
               {% else %}
               {% include 'members/default_profile_img.html' %}
              {%endif%}
            </span>

              <b style="margin-right:-10px;" class="author author-comment">{{comment.name}} הגיב:</b>


                 {% if user.is_authenticated %}
                 <form class="super-tiny-row-center-align" id="frm-like-comments" method="POST" action="{% url 'magazine:rate_com' comment.pk %}">
                   {%csrf_token%}
                 <button class="unstyled-btn" name="like-com" type="submit">
                 {% if comment.liked %}
                 {% include 'magazine/components/svg/like_fill.html'%}
                 {% else %}
                 {% include 'magazine/components/svg/like.html'%}
                 {% endif %}
                </button>
                 {% if comment.total_likes != 0 %}
                 <span class="rate-count rate-green">{{comment.total_likes}}</span>
                 {% endif %}
                 <button class="unstyled-btn" name="dislike-com">
                 {% if comment.disliked %}
                 {% include 'magazine/components/svg/dislike_fill.html'%}
                 {% else %}
                 {% include 'magazine/components/svg/dislike.html'%}
                 {% endif %}
               </button>
                {% if comment.total_dislikes != 0 %}
                 <span class="rate-count rate-red">{{comment.total_dislikes}}</span>
                {% endif %}
               </form>
                {% else %}
                <button class="unstyled-btn" type="button">
                    {% include 'magazine/components/svg/like.html'%}
                </button>
                {% if comment.total_likes != 0 %}
                <span class="rate-count rate-green">{{comment.total_likes}}</span>
                {% endif %}
                <button class="unstyled-btn"  type="button">
                    {% include 'magazine/components/svg/dislike.html'%}
                </button>
                {% if comment.total_dislikes != 0 %}
                 <span class="rate-count rate-red">{{comment.total_dislikes}}</span>
                 {% endif %}
                 <span class="msg ice-cream-clr">הירשם ותוכל להשפיע</span>
                {% endif %}


            </div>
            <a id="{{comment.pk}}" href ="#comment{{comment.pk}}" class="tiny-row-center-align"><span style="color:#2F9BDD;">{{comment.date_added | date:'d/m/Y' | safe}} בשעה: {{comment.date_added | date:'h:m' | safe}}</span></a>
          </span>
          {{comment.body}}
          <div class="reply-parent">

          <span class="reply-label" comment-id="{{comment.pk}}">{% include 'magazine/components/svg/reply.svg' %}</span>
         </div>

          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill expand" viewBox="0 0 16 16" style="display:none;margin-top:5px;">
          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
          </svg>

          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-circle-fill collpase" viewBox="0 0 16 16" style="margin-top:5px;">
         <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7z"/>
         </svg>
          <div class="comment-of-comment">
          {% for comment_of_comment in comment.comments_of_comment.all %}
          <div class="item subitem" id="sub-comment{{comment_of_comment.pk}}" style="margin-top:10px;">
          <span style="gap:5px;">
            <div class="super-tiny-row-center-align" style="gap:5px;">

              <span class="order-num" style="left:10px;position:relative;">
                {% if comment_of_comment.comment_of_comment_usr.profile.profile_img.url %}
               <img class="super-tiny-avatar" src="{{comment_of_comment.comment_of_comment_usr.profile.profile_img.url}}"/>
               {% else %}
               {% include 'members/default_profile_img.html' %}
              {%endif%}
            </span>
              <b style="margin-right:-10px;" class="author author-sub-comment">{{comment_of_comment.name}} הגיב:</b>


              {% if user.is_authenticated %}
              <form class="super-tiny-row-center-align" id="frm-like-com-of-com" method="POST" action="{% url 'magazine:rate_com_of_com' comment_of_comment.pk %}">
                {%csrf_token%}
              <button class="unstyled-btn" name="like-com-of-com" type="submit">
              {% if comment_of_comment.liked %}
              <span class="com-of-com-svg">{% include 'magazine/components/svg/like_fill.html' %}</span>
              {% else %}
              <span class="com-of-com-svg">{% include 'magazine/components/svg/like.html' %}</span>
              {% endif %}
             </button>
              {% if comment_of_comment.total_likes != 0 %}
              <span class="rate-green com-of-com-svg">{{comment_of_comment.total_likes}}</span>
              {% endif %}
              <button class="unstyled-btn" name="dislike-com-of-com">
              {% if comment_of_comment.disliked %}
              <span class="com-of-com-svg">{% include 'magazine/components/svg/dislike_fill.html' %}</span>
              {% else %}
              <span class="com-of-com-svg">{% include 'magazine/components/svg/dislike.html' %}</span>
              {% endif %}
            </button>
             {% if comment_of_comment.total_dislikes != 0 %}
              <span class="com-of-com-svg rate-red">{{comment_of_comment.total_dislikes}}</span>
             {% endif %}
            </form>
             {% else %}
             <button class="unstyled-btn com-of-com-svg" type="button">
                 {% include 'magazine/components/svg/like.html' %}
             </button>
             {% if comment_of_comment.total_likes != 0 %}
             <span class="com-of-com-svg rate-green">{{comment_of_comment.total_likes}}</span>
             {% endif %}
             <button class="unstyled-btn com-of-com-svg"  type="button">
                {% include 'magazine/components/svg/dislike.html' %}
             </button>
             {% if comment_of_comment.total_dislikes != 0 %}
              <span class="com-of-com-svg rate-red">{{comment_of_comment.total_dislikes}}</span>
              {% endif %}
              <span class="msg ice-cream-clr" style="font-size:1rem;">הירשם ותוכל להשפיע</span>
             {% endif %}


            </div>

            <a id="a-sub-comment{{comment_of_comment.pk}}" href ="#sub-comment{{comment_of_comment.pk}}" class="tiny-row-center-align"><span class="tiny-font" style="color:#2F9BDD;">{{comment_of_comment.date_added | date:'d/m/Y' | safe}} בשעה: {{comment_of_comment.date_added | date:'h:m' | safe}}</span></a>
          </span>
          <span class="sub-comment">{{comment_of_comment.body}}</span>
        </div>
        {% endfor %}
      </div>
        </div>

      {% endfor %}

   {% endif %}
   <div id="reply-frm" style="display:none;">
   <form method="post">
  {%csrf_token%}
   <div>
         <div class="center">
               <input type="hidden" name="comment_id" id="comment_id">
                <div class="comment comment-frm">
                   <div style="width:100%;">
                     <span class="comment-label">התגובה שלך</span>
                     {{com_of_com_frm.body}}
                  </div>
                  <div style="width:100%;">
                    <span class="comment-label">שם</span>
                    {{com_of_com_frm.name}}
                </div>
               <button type="submit" class="btn-post-comment" id="btn-reply-comment-of-comment" name="btn-reply-comment-of-comment">הגב</button>
              <!--{% include 'magazine/components/svg/reply.svg' %}-->
             </div>
             </div>
   </div>
 </form>
</div>
</div>
{% if user.is_authenticated %}
<input type="hidden" id="curr-user" value="{{user.username}}">
{% endif %}
<input type="hidden" id="post_pk" value="{{object.pk}}" name="post_pk"/>
</div>


<!--</form>-->





  <script type="text/javascript" src="{% static 'plugins/jquery.js'%}"> </script>
   <script>
   /*$('#btn-reply-comment-of-comment').click(function(){

     $('#reply-frm').submit();

   });*/
    $(document).ready(function(){

       $('.comment.item').each(function(){
         var sub_comments_count = $(this).find('.subitem').length;
         if(sub_comments_count == 0)
         {
           $(this).find('.expand').first().hide();

           $(this).find('.collpase').first().hide();
         }
       });
      var total_comments = $('.item').length;
       $('#lbl-count-comments').text(total_comments);
      if("{{status}}" == "posted")
      {
         $('.comment-field').val('');
         var a_id =  "{{com_obj.pk}}";
         var href = $("#" + String(a_id)).attr("href");
         window.location.href = href
      }
      var replace_str = '-replace-me-'
      var curr_url = window.location.href

      if(curr_url.includes(replace_str))
      {
        jump_to = curr_url.replace('-replace-me-', '#')
        window.location.href = jump_to
      }
      setInterval(check_post_rating, 10000)
    });

    $('.reply-label').click(function(){

      frm = $(this).next('#reply-frm');
      var frm_id = $(frm).attr('id');
      var is_frm_after_this_lbl = false;
      if(frm_id == 'reply-frm')
      {
        is_frm_after_this_lbl = true;
      }

      if(is_frm_after_this_lbl && $('#reply-frm').css('display').toLowerCase() != 'none')
      {
          $('#reply-frm').hide();
          return;
      }
      $(this).after($('#reply-frm'));
      $('#comment_id').val($(this).attr('comment-id'));
      $('#reply-frm').show();



    });

    $('.expand').click(function(){
      $(this).nextAll('.comment-of-comment').show();
      $(this).hide();
      $(this).siblings('.collpase').first().show();
    });

    $('.collpase').click(function(){
      $(this).nextAll('.comment-of-comment').hide();
      $(this).hide();
      $(this).siblings('.expand').first().show();
    });
   </script>


  {%endblock body%}

{%block moreJs%}

<script>

function check_post_rating()
{

     var csrftoken = $('[name="csrfmiddlewaretoken"]').val()
        $.ajax({
            type: 'GET',
            url: "{% url 'social:rate_post_refresh_ajax' %}",
            data: {'post_pk':$('#post_pk').val(),
                  'csrfmiddlewaretoken': csrftoken,
            },
            dataType: 'json',
            success: function (response) {
            //var result = JSON.parse(response);
            //alert('result=' + response[0]['user'])
              var cnt_likes = 0 ;
              var cnt_dislikes = 0;
              var is_user_liked = false;
              var is_user_disliked = false;
              var curr_user = '';

              if($('#curr-user').length)
              {
                 curr_user = $('#curr-user').val();
              }
              for(var i=0;i<response.length;i++)
              {
                  var rate_type = response[i]['rate-type']

                  if(rate_type == 'like')
                  {
                      cnt_likes += 1;
                      if(response[i]['user'] == curr_user)
                      {
                        is_user_liked = true;
                      }
                  }
                  if(rate_type == 'dislike')
                  {
                    cnt_dislikes += 1;
                    if(response[i]['user'] == curr_user)
                    {
                      is_user_disliked = true;
                    }

                  }
                 if(cnt_likes > 0)
                 {

                  $('#rate-post-form .rate-count.rate-green').text(cnt_likes);
                  $('#rate-post-form .rate-count.rate-green').show();

                 }
                 if(cnt_dislikes > 0)
                 {

                   $('#rate-post-form .rate-count.rate-red').text(cnt_dislikes);
                   $('#rate-post-form .rate-count.rate-red').show();

                 }

              }
              if(cnt_likes == 0)
              {
                $('#rate-post-form .rate-count.rate-green').hide();
              }
              if(cnt_dislikes == 0)
              {
                $('#rate-post-form .rate-count.rate-red').hide();
              }
              if(is_user_liked)
              {
                $('.user_liked').show();
                $('.user_unliked').hide();
                $('.user_disliked').hide();
                $('.user_undisliked').show();

              }
              else if(is_user_disliked)
              {
                $('.user_liked').hide();
                $('.user_unliked').show();
                $('.user_disliked').show();
                $('.user_undisliked').hide();
              }
              else
              {
                $('.user_liked').hide();
                $('.user_unliked').show();
                $('.user_disliked').hide();
                $('.user_undisliked').show();
              }

            },
            error: function (response) {
                console.log(response);
            }
        })
  }
</script>

  <script>
    var csrftoken = $('[name="csrfmiddlewaretoken"]').val()
    $("#rate-post-form .ajax-rate-btn").click(function () {
        var rate_type = $(this).attr('name');
        $.ajax({
            type: 'POST',
            url: "{% url 'social:rate_post_save_ajax' %}",
            data: {'rate_type':rate_type,
                  'post_pk':$('#post_pk').val(),
                  'csrfmiddlewaretoken': csrftoken,
                  },
            success: function (response) {
                check_post_rating()

            },
            error: function (response) {

            }
        })
    })
</script>



{%endblock moreJs%}
